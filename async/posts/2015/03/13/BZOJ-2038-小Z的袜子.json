{"tags":[{"name":"莫队","permalink":"http://lzy-foenix.github.io/tags/莫队/","url":"\\async\\tags\\莫队.json","count":1}],"categories":[{"name":"分块","permalink":"http://lzy-foenix.github.io/categories/分块/","url":"\\async\\categories\\分块.json","count":3}],"url":"\\async\\posts\\2015\\03\\13\\BZOJ-2038-小Z的袜子.json","date":1426251725000,"path":{"year":2015,"month":3,"day":13,"name":"BZOJ-2038-小Z的袜子"},"title":"BZOJ-2038-小Z的袜子","permalink":"http://lzy-foenix.github.io/2015/03/13/BZOJ-2038-小Z的袜子/","content":"<hr>\n<a id=\"more\"></a>\n<h3 id=\"题解：\"><a href=\"#题解：\" class=\"headerlink\" title=\"题解：\"></a>题解：</h3><p>这道题是莫涛大神出的一道莫队的模板题，莫队算法详情请见<a href=\"http://blog.csdn.net/huzecong/article/details/8576908\" target=\"_blank\" rel=\"external\">http://blog.csdn.net/huzecong/article/details/8576908</a></p>\n<p>原文的莫队算法是用曼哈顿最小生成树做的，但是我们直接用分块就可以水过去了。</p>\n<p>我们假设一段区间内有各种颜色分别是a,b,c….种<br>那么答案就是<br>Ans={a<em>(a-1)/2+b</em>(b-1)/2+c<em>(c-1)/2+…+}/{(R-L+1)</em>(R-L}/2);<br>整理可得到<br>Ans={a^2+b^2+c^2+…+-(a+b+c+…+)}/{(R-L+1)<em>(R-l)};<br>Ans={a^2+b^2+c^2+…+-(R-L+1)}/{(R-L+1)</em>(R-l)};</p>\n<p>然后用莫队维护这个答案。</p>\n<h3 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码:\"></a>代码:</h3><figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;cstdio&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;cstdlib&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;cstring&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;set&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;cmath&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;queue&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;ctime&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></div><div class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;algorithm&gt;</span></span></div><div class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> <span class=\"built_in\">std</span>;</div><div class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> LL;</div><div class=\"line\"><span class=\"keyword\">const</span> <span class=\"keyword\">int</span> MAXN=<span class=\"number\">50005</span>;</div><div class=\"line\"><span class=\"keyword\">int</span> N,M,Color[MAXN];</div><div class=\"line\"><span class=\"keyword\">int</span> belong[MAXN],block;</div><div class=\"line\">LL nowans,s[MAXN];<span class=\"comment\">//s数组代表每一种颜色有多少种</span></div><div class=\"line\"><span class=\"keyword\">struct</span> node&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> l,r,pi;<span class=\"comment\">//记录左端点，右端点，每个询问的标号，以便于之后排序排回来 </span></div><div class=\"line\">\tLL ans1,ans2;<span class=\"comment\">//记录两个ans</span></div><div class=\"line\">&#125;A[MAXN];</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">comp1</span><span class=\"params\">(<span class=\"keyword\">const</span> node &amp;A,<span class=\"keyword\">const</span> node &amp;B)</span></span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">if</span>(belong[A.l]==belong[B.l])<span class=\"keyword\">return</span> A.r&lt;B.r;</div><div class=\"line\">\t<span class=\"keyword\">else</span> <span class=\"keyword\">return</span> belong[A.l]&lt;belong[B.l];</div><div class=\"line\">&#125;<span class=\"comment\">//按照左端点所属块排序，如果在同一个块内就按照右端点排序</span></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">bool</span> <span class=\"title\">comp2</span><span class=\"params\">(<span class=\"keyword\">const</span> node &amp;A,<span class=\"keyword\">const</span> node &amp;B)</span></span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">return</span> A.pi&lt;B.pi;<span class=\"comment\">//排回去 </span></div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">int</span> <span class=\"title\">Get</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">\t<span class=\"keyword\">int</span> x;<span class=\"keyword\">char</span> ch;</div><div class=\"line\">\t<span class=\"keyword\">while</span>(!<span class=\"built_in\">isdigit</span>(ch=getchar()));</div><div class=\"line\">\tx=ch<span class=\"number\">-48</span>;</div><div class=\"line\">\t<span class=\"keyword\">while</span>(<span class=\"built_in\">isdigit</span>(ch=getchar()))x=x*<span class=\"number\">10</span>+ch<span class=\"number\">-48</span>;</div><div class=\"line\">\t<span class=\"keyword\">return</span> x;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\">LL <span class=\"title\">sqr</span><span class=\"params\">(LL x)</span></span>&#123;<span class=\"keyword\">return</span> x*x;&#125;</div><div class=\"line\"><span class=\"function\">LL <span class=\"title\">Gcd</span><span class=\"params\">(LL a,LL b)</span></span>&#123;<span class=\"keyword\">return</span> b==<span class=\"number\">0</span>? a:Gcd(b,a%b);&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">Add</span><span class=\"params\">(<span class=\"keyword\">int</span> p,<span class=\"keyword\">int</span> data)</span></span>&#123;</div><div class=\"line\">\tnowans-=sqr(s[Color[p]]);</div><div class=\"line\">\ts[Color[p]]+=data; </div><div class=\"line\">\tnowans+=sqr(s[Color[p]]);</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</div><div class=\"line\">\t<span class=\"built_in\">scanf</span>(<span class=\"string\">\"%d%d\"</span>,&amp;N,&amp;M); block=<span class=\"built_in\">sqrt</span>(N);</div><div class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=N;i++)Color[i]=Get();</div><div class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=N;i++)belong[i]=(i<span class=\"number\">-1</span>)/block+<span class=\"number\">1</span>;</div><div class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=M;i++)A[i].l=Get(),A[i].r=Get(),A[i].pi=i;</div><div class=\"line\">\tsort(A+<span class=\"number\">1</span>,A+M+<span class=\"number\">1</span>,comp1);</div><div class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>,l=<span class=\"number\">1</span>,r=<span class=\"number\">0</span>;i&lt;=M;i++)&#123;</div><div class=\"line\">\t\t<span class=\"keyword\">while</span>(l&lt;A[i].l)Add(l,<span class=\"number\">-1</span>),l++;<span class=\"comment\">//这个自己YY就好了</span></div><div class=\"line\">\t\t<span class=\"keyword\">while</span>(l&gt;A[i].l)l--,Add(l,<span class=\"number\">1</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">while</span>(r&lt;A[i].r)r++,Add(r,<span class=\"number\">1</span>);</div><div class=\"line\">\t\t<span class=\"keyword\">while</span>(r&gt;A[i].r)Add(r,<span class=\"number\">-1</span>),r--;</div><div class=\"line\">\t\tLL tmp1=nowans-(A[i].r-A[i].l+<span class=\"number\">1</span>);</div><div class=\"line\">\t\tLL tmp2=(LL)(A[i].r-A[i].l)*(A[i].r-A[i].l+<span class=\"number\">1</span>);</div><div class=\"line\">\t\tLL k=Gcd(tmp1,tmp2);</div><div class=\"line\">\t\ttmp1/=k; tmp2/=k;</div><div class=\"line\">\t\tA[i].ans1=tmp1; A[i].ans2=tmp2;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tsort(A+<span class=\"number\">1</span>,A+M+<span class=\"number\">1</span>,comp2);</div><div class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=M;i++)<span class=\"built_in\">printf</span>(<span class=\"string\">\"%lld/%lld\\n\"</span>,A[i].ans1,A[i].ans2);</div><div class=\"line\">\tfclose(<span class=\"built_in\">stdin</span>);</div><div class=\"line\">\tfclose(<span class=\"built_in\">stdout</span>);</div><div class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>###同类题目：<br>BZOJ-3289-Mato的文件管理<br><a href=\"http://www.lydsy.com/JudgeOnline/problem.php?id=3289\" target=\"_blank\" rel=\"external\">http://www.lydsy.com/JudgeOnline/problem.php?id=3289</a></p>\n<p>cogs-1822-作业<br><a href=\"http://cogs.yeefan.us/cogs/problem/problem.php?pid=1822\" target=\"_blank\" rel=\"external\">http://cogs.yeefan.us/cogs/problem/problem.php?pid=1822</a></p>\n"}