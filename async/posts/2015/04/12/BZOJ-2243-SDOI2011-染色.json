{"tags":[{"name":"树链剖分","permalink":"http://lzy-foenix.github.io/tags/树链剖分/","url":"\\async\\tags\\树链剖分.json","count":4}],"categories":[{"name":"数据结构","permalink":"http://lzy-foenix.github.io/categories/数据结构/","url":"\\async\\categories\\数据结构.json","count":18}],"url":"\\async\\posts\\2015\\04\\12\\BZOJ-2243-SDOI2011-染色.json","date":1428829420000,"path":{"year":2015,"month":4,"day":12,"name":"BZOJ-2243-SDOI2011-染色"},"title":"BZOJ-2243[SDOI2011]染色","permalink":"http://lzy-foenix.github.io/2015/04/12/BZOJ-2243-SDOI2011-染色/","content":"<hr>\n<a id=\"more\"></a>\n<h3 id=\"题解：\"><a href=\"#题解：\" class=\"headerlink\" title=\"题解：\"></a>题解：</h3><p>用线段树维护三个信息，lcol-&gt;线段左端点的颜色，rcol-&gt;线段右端点的颜色，sum-&gt;线段的颜色段数目。</p>\n<p>合并操作的就将两段区间的sum加起来，再减去(Seg[root&lt;&lt;1].rcol==Seg[root&lt;&lt;1|1].lcol)，查询操作的时候，还要注意，这一条链和下一条链的端点部分也要判断是否相同，如果相同的话Ans–。</p>\n<p>注意颜色可能会有0，所以初始化要赋值为-1.</p>\n<h3 id=\"代码：\"><a href=\"#代码：\" class=\"headerlink\" title=\"代码：\"></a>代码：</h3><figure class=\"highlight plain\"><figcaption><span><cstdio></cstdio></span></figcaption><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div><div class=\"line\">22</div><div class=\"line\">23</div><div class=\"line\">24</div><div class=\"line\">25</div><div class=\"line\">26</div><div class=\"line\">27</div><div class=\"line\">28</div><div class=\"line\">29</div><div class=\"line\">30</div><div class=\"line\">31</div><div class=\"line\">32</div><div class=\"line\">33</div><div class=\"line\">34</div><div class=\"line\">35</div><div class=\"line\">36</div><div class=\"line\">37</div><div class=\"line\">38</div><div class=\"line\">39</div><div class=\"line\">40</div><div class=\"line\">41</div><div class=\"line\">42</div><div class=\"line\">43</div><div class=\"line\">44</div><div class=\"line\">45</div><div class=\"line\">46</div><div class=\"line\">47</div><div class=\"line\">48</div><div class=\"line\">49</div><div class=\"line\">50</div><div class=\"line\">51</div><div class=\"line\">52</div><div class=\"line\">53</div><div class=\"line\">54</div><div class=\"line\">55</div><div class=\"line\">56</div><div class=\"line\">57</div><div class=\"line\">58</div><div class=\"line\">59</div><div class=\"line\">60</div><div class=\"line\">61</div><div class=\"line\">62</div><div class=\"line\">63</div><div class=\"line\">64</div><div class=\"line\">65</div><div class=\"line\">66</div><div class=\"line\">67</div><div class=\"line\">68</div><div class=\"line\">69</div><div class=\"line\">70</div><div class=\"line\">71</div><div class=\"line\">72</div><div class=\"line\">73</div><div class=\"line\">74</div><div class=\"line\">75</div><div class=\"line\">76</div><div class=\"line\">77</div><div class=\"line\">78</div><div class=\"line\">79</div><div class=\"line\">80</div><div class=\"line\">81</div><div class=\"line\">82</div><div class=\"line\">83</div><div class=\"line\">84</div><div class=\"line\">85</div><div class=\"line\">86</div><div class=\"line\">87</div><div class=\"line\">88</div><div class=\"line\">89</div><div class=\"line\">90</div><div class=\"line\">91</div><div class=\"line\">92</div><div class=\"line\">93</div><div class=\"line\">94</div><div class=\"line\">95</div><div class=\"line\">96</div><div class=\"line\">97</div><div class=\"line\">98</div><div class=\"line\">99</div><div class=\"line\">100</div><div class=\"line\">101</div><div class=\"line\">102</div><div class=\"line\">103</div><div class=\"line\">104</div><div class=\"line\">105</div><div class=\"line\">106</div><div class=\"line\">107</div><div class=\"line\">108</div><div class=\"line\">109</div><div class=\"line\">110</div><div class=\"line\">111</div><div class=\"line\">112</div><div class=\"line\">113</div><div class=\"line\">114</div><div class=\"line\">115</div><div class=\"line\">116</div><div class=\"line\">117</div><div class=\"line\">118</div><div class=\"line\">119</div><div class=\"line\">120</div><div class=\"line\">121</div><div class=\"line\">122</div><div class=\"line\">123</div><div class=\"line\">124</div><div class=\"line\">125</div><div class=\"line\">126</div><div class=\"line\">127</div><div class=\"line\">128</div><div class=\"line\">129</div><div class=\"line\">130</div><div class=\"line\">131</div><div class=\"line\">132</div><div class=\"line\">133</div><div class=\"line\">134</div><div class=\"line\">135</div><div class=\"line\">136</div><div class=\"line\">137</div><div class=\"line\">138</div><div class=\"line\">139</div><div class=\"line\">140</div><div class=\"line\">141</div><div class=\"line\">142</div><div class=\"line\">143</div><div class=\"line\">144</div><div class=\"line\">145</div><div class=\"line\">146</div><div class=\"line\">147</div><div class=\"line\">148</div><div class=\"line\">149</div><div class=\"line\">150</div><div class=\"line\">151</div><div class=\"line\">152</div><div class=\"line\">153</div><div class=\"line\">154</div><div class=\"line\">155</div><div class=\"line\">156</div><div class=\"line\">157</div><div class=\"line\">158</div><div class=\"line\">159</div><div class=\"line\">160</div><div class=\"line\">161</div><div class=\"line\">162</div><div class=\"line\">163</div><div class=\"line\">164</div><div class=\"line\">165</div><div class=\"line\">166</div><div class=\"line\">167</div><div class=\"line\">168</div><div class=\"line\">169</div><div class=\"line\">170</div><div class=\"line\">171</div><div class=\"line\">172</div><div class=\"line\">173</div><div class=\"line\">174</div><div class=\"line\">175</div><div class=\"line\">176</div><div class=\"line\">177</div></pre></td><td class=\"code\"><pre><div class=\"line\">#include &lt;iostream&gt;</div><div class=\"line\">#include &lt;cstring&gt;</div><div class=\"line\">#include &lt;cstdlib&gt;</div><div class=\"line\">#include &lt;cmath&gt;</div><div class=\"line\">#include &lt;algorithm&gt;</div><div class=\"line\">#include &lt;queue&gt;</div><div class=\"line\">#include &lt;set&gt;</div><div class=\"line\">#include &lt;ctime&gt;</div><div class=\"line\">using namespace std;</div><div class=\"line\">const int MAXN=140010;</div><div class=\"line\"></div><div class=\"line\">struct node&#123;</div><div class=\"line\">\tint to,next;</div><div class=\"line\">&#125;Edge[MAXN&lt;&lt;1];</div><div class=\"line\"></div><div class=\"line\">int N,Q,len,num;</div><div class=\"line\">int fa[MAXN],son[MAXN],Deep[MAXN],siz[MAXN],Col[MAXN],head[MAXN];</div><div class=\"line\">int w[MAXN],fw[MAXN],top[MAXN];</div><div class=\"line\"></div><div class=\"line\">inline void DFS1(int u)&#123;</div><div class=\"line\">\tsiz[u]=1; son[u]=0;</div><div class=\"line\">\tfor(int i=head[u];i!=0;i=Edge[i].next)&#123;</div><div class=\"line\">\t\tint p=Edge[i].to;</div><div class=\"line\">\t\tif(p!=fa[u])&#123;</div><div class=\"line\">\t\t\tfa[p]=u; Deep[p]=Deep[u]+1;</div><div class=\"line\">\t\t\tDFS1(p);</div><div class=\"line\">\t\t\tsiz[u]+=siz[p];</div><div class=\"line\">\t\t\tif(siz[p]&gt;siz[son[u]]) son[u]=p;</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">void DFS2(int x,int root)&#123;</div><div class=\"line\">\tw[x]=++num; fw[w[x]]=x; top[x]=root;</div><div class=\"line\">\tif(!son[x])return;</div><div class=\"line\">\tDFS2(son[x],root);</div><div class=\"line\">\tfor(int i=head[x];i;i=Edge[i].next)&#123;</div><div class=\"line\">\t\tint y=Edge[i].to;</div><div class=\"line\">\t\tif(y!=fa[x] &amp;&amp; y!=son[x])DFS2(y,y);</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">void Add_edge(int a,int b)&#123;</div><div class=\"line\">\tlen++; Edge[len].to=b; Edge[len].next=head[a]; head[a]=len;</div><div class=\"line\">\tlen++; Edge[len].to=a; Edge[len].next=head[b]; head[b]=len;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">#define lson root&lt;&lt;1,l,mid</div><div class=\"line\">#define rson root&lt;&lt;1|1,mid+1,r</div><div class=\"line\">#define lc root&lt;&lt;1</div><div class=\"line\">#define rc root&lt;&lt;1|1</div><div class=\"line\"></div><div class=\"line\">int Ql,Qr,Val,Ans,l_col,r_col;</div><div class=\"line\">int lcol[MAXN&lt;&lt;2],rcol[MAXN&lt;&lt;2],Sum[MAXN&lt;&lt;2],flag[MAXN&lt;&lt;2];</div><div class=\"line\"></div><div class=\"line\">void Push_up(int root)&#123;</div><div class=\"line\">\trcol[root]=rcol[rc]; lcol[root]=lcol[lc];</div><div class=\"line\">\tSum[root]=Sum[lc]+Sum[rc]-(rcol[lc]==lcol[rc]);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">void Push_down(int root)&#123;</div><div class=\"line\">\tif(flag[root]!=-1)&#123;</div><div class=\"line\">\t\tflag[lc]=flag[rc]=lcol[root]=rcol[root]=flag[root];</div><div class=\"line\">\t\tlcol[lc]=rcol[lc]=lcol[rc]=rcol[rc]=flag[root];</div><div class=\"line\">\t\tSum[root]=Sum[lc]=Sum[rc]=1;</div><div class=\"line\">\t\tflag[root]=-1;</div><div class=\"line\">\t&#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">void Build(int root,int l,int r)&#123;</div><div class=\"line\">\tif(l==r)&#123;</div><div class=\"line\">\t\tSum[root]=1;</div><div class=\"line\">\t\tlcol[root]=rcol[root]=Col[fw[l]];</div><div class=\"line\">\t\treturn;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tint mid=(l+r)&gt;&gt;1;</div><div class=\"line\">\tBuild(lson); Build(rson);</div><div class=\"line\">\tPush_up(root);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">void _change(int root,int l,int r)&#123;</div><div class=\"line\">\tif(Ql&lt;=l &amp;&amp; Qr&gt;=r)&#123;</div><div class=\"line\">\t\tflag[root]=Val;</div><div class=\"line\">\t\tPush_down(root);</div><div class=\"line\">\t\treturn;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tint mid=(l+r)&gt;&gt;1;</div><div class=\"line\">\tPush_down(root);</div><div class=\"line\">\tif(Ql&lt;=mid) _change(lson);</div><div class=\"line\">\tif(Qr&gt; mid) _change(rson);</div><div class=\"line\">\tPush_up(root);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">int _query(int root,int l,int r)&#123;</div><div class=\"line\">\tif(Ql==l)l_col=lcol[root];</div><div class=\"line\">\tif(Qr==r)r_col=rcol[root];</div><div class=\"line\">\tif(Ql&lt;=l &amp;&amp; Qr&gt;=r)&#123;</div><div class=\"line\">\t\treturn Sum[root];</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tPush_down(root);</div><div class=\"line\">\tint mid=(l+r)&gt;&gt;1;</div><div class=\"line\">\tint ret=0;</div><div class=\"line\">\tif(Ql&lt;=mid) ret+=_query(lson);</div><div class=\"line\">\tif(Qr&gt; mid) ret+=_query(rson);</div><div class=\"line\">\tif(Ql&lt;=mid &amp;&amp;mid&lt;Qr)ret-=(rcol[lc]==lcol[rc]);</div><div class=\"line\">\treturn ret;</div><div class=\"line\">\tPush_up(root);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">void Change(int x,int y,int c)&#123;</div><div class=\"line\">\tint fx=top[x],fy=top[y];</div><div class=\"line\">\tVal=c;</div><div class=\"line\">\twhile(fx!=fy)&#123;</div><div class=\"line\">\t\tif(Deep[fx]&lt;Deep[fy])&#123;</div><div class=\"line\">\t\t\tswap(x,y); swap(fx,fy);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\tQl=w[fx]; Qr=w[x];</div><div class=\"line\">\t\t_change(1,1,num);</div><div class=\"line\">\t\tx=fa[fx]; fx=top[x];</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tif(Deep[x]&gt;Deep[y])swap(x,y);</div><div class=\"line\">\tQl=w[x]; Qr=w[y];</div><div class=\"line\">\t_change(1,1,num);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">void Query(int x,int y)&#123;</div><div class=\"line\">\tint ret=0,c1=-1,c2=-1,fx=top[x],fy=top[y];</div><div class=\"line\">\twhile(fx!=fy)&#123;//c1记录上一段的左端点的颜色 </div><div class=\"line\">\t\tif(Deep[fx]&lt;Deep[fy])&#123;</div><div class=\"line\">\t\t\tswap(x,y); swap(fx,fy); swap(c1,c2);</div><div class=\"line\">\t\t&#125;//c1,c2千万不能忘记交换，因为当我们换了x,y </div><div class=\"line\">\t\t//之后，就相当于换了一条链，所以c1,c2必须要换 </div><div class=\"line\">\t\tQl=w[fx]; Qr=w[x];</div><div class=\"line\">\t\tret+=_query(1,1,num);</div><div class=\"line\">\t\tret-=(c1==r_col);//判断上一条链的左端点是否等于现在这条链的右端点 </div><div class=\"line\">\t\tc1=l_col;</div><div class=\"line\">\t\tx=fa[fx]; fx=top[x];</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tif(Deep[x]&gt;Deep[y])swap(x,y),swap(c1,c2);</div><div class=\"line\">\tQl=w[x]; Qr=w[y];</div><div class=\"line\">\tret+=_query(1,1,num);</div><div class=\"line\">\t//由于这是最后的部分，所以我们要判断两次，这一次的左端点(更靠近根)与上一次的左端点(更靠近根) </div><div class=\"line\">\t//这一次的右端点(远离根)与上一次的左端点(靠近根) </div><div class=\"line\">\tret-=(c1==l_col)+(c2==r_col);</div><div class=\"line\">\tprintf(&quot;%d\\n&quot;,ret);</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\">int main()&#123;</div><div class=\"line\">\tscanf(&quot;%d%d&quot;,&amp;N,&amp;Q);</div><div class=\"line\">\tfor(int i=1;i&lt;=N;i++)scanf(&quot;%d&quot;,&amp;Col[i]);</div><div class=\"line\">\tfor(int i=1;i&lt;N;i++)&#123;</div><div class=\"line\">\t\tint x,y;</div><div class=\"line\">\t\tscanf(&quot;%d%d&quot;,&amp;x,&amp;y);</div><div class=\"line\">\t\tAdd_edge(x,y);</div><div class=\"line\">\t&#125;//初始化为了避免=0的情况，就要赋值为-1 </div><div class=\"line\">\tmemset(flag,-1,sizeof(flag));</div><div class=\"line\">\tmemset(lcol,-1,sizeof(lcol));</div><div class=\"line\">\tmemset(rcol,-1,sizeof(rcol));</div><div class=\"line\">\tDFS1(1); DFS2(1,1);</div><div class=\"line\">\tBuild(1,1,num);</div><div class=\"line\">\tchar ch[10];</div><div class=\"line\">\tint a,b,c;</div><div class=\"line\">\tfor(int i=1;i&lt;=Q;i++)&#123;</div><div class=\"line\">\t\tscanf(&quot;%s&quot;,ch);</div><div class=\"line\">\t\tif(ch[0]==&apos;C&apos;)&#123;</div><div class=\"line\">\t\t\tscanf(&quot;%d%d%d&quot;,&amp;a,&amp;b,&amp;c);</div><div class=\"line\">\t\t\tChange(a,b,c);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t\telse&#123;</div><div class=\"line\">\t\t\tscanf(&quot;%d%d&quot;,&amp;a,&amp;b);</div><div class=\"line\">\t\t\tQuery(a,b);</div><div class=\"line\">\t\t&#125;</div><div class=\"line\">\t&#125;</div><div class=\"line\">\tfclose(stdin);</div><div class=\"line\">\tfclose(stdout);</div><div class=\"line\">\treturn 0;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>"}